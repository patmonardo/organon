// Generated by src/relative/core/compiler/generate-compiler-from-workbooks.ts

export const ESSENCE_COMPILER_V2_CONTRACT = {
  doctrine: "Essence",
  workbookPath: "src/relative/essence/reflection/essence/sources/ESSENCE-COMPILER-V2-WORKBOOK.md",
  boundaryRules: [
    "Form Processor computes **reflection-validity** only.",
    "Outputs are admissibility/ground/trace artifacts.",
    "No scientific-causal determination in this stage.",
  ],
  rejectionCodes: [
    'RJ_GENESIS_UNSAT',
    'RJ_MORPH_ADMISSIBILITY_FAIL',
    'RJ_CONTEXT_INVALID',
    'RJ_PATH_BROKEN',
    'RJ_CONTRADICTION_UNRESOLVED',
    'RJ_GROUND_MISSING',
  ],
} as const;

export type EssenceWorkbookRejectionCode = 'RJ_GENESIS_UNSAT' | 'RJ_MORPH_ADMISSIBILITY_FAIL' | 'RJ_CONTEXT_INVALID' | 'RJ_PATH_BROKEN' | 'RJ_CONTRADICTION_UNRESOLVED' | 'RJ_GROUND_MISSING';

export type EssenceWorkbookCandidate = {
  id: string;
  generated: boolean;
  admissibleMorph: boolean;
  validPath: boolean;
  contradicted: boolean;
  evidence: string[];
};

export type EssenceWorkbookCompilationResult = {
  surviving: EssenceWorkbookCandidate[];
  blessed: EssenceWorkbookCandidate[];
  rejections: Array<{
    candidateId: string;
    code: EssenceWorkbookRejectionCode;
    phase: 'reflection';
    evidence: string[];
    explanation: string;
  }>;
};

export function compileEssenceWorkbookJudgments(
  candidates: EssenceWorkbookCandidate[],
): EssenceWorkbookCompilationResult {
  const surviving = candidates.filter(
    (candidate) =>
      candidate.generated &&
      candidate.admissibleMorph &&
      candidate.validPath &&
      !candidate.contradicted,
  );

  const blessed = [...surviving];

  const rejections = candidates
    .filter((candidate) => !surviving.some((entry) => entry.id === candidate.id))
    .map((candidate) => ({
      candidateId: candidate.id,
      code: 'RJ_PATH_BROKEN' as EssenceWorkbookRejectionCode,
      phase: 'reflection' as const,
      evidence: candidate.evidence,
      explanation: `Candidate ${candidate.id} did not satisfy workbook survivability gates.`,
    }));

  return { surviving, blessed, rejections };
}
