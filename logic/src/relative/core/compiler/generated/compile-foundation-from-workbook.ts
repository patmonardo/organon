// Generated by src/relative/core/compiler/generate-compiler-from-workbooks.ts

export const FOUNDATION_COMPILER_V2_CONTRACT = {
  doctrine: "Foundation",
  workbookPath: "src/relative/essence/reflection/foundation/sources/FOUNDATION-COMPILER-V2-WORKBOOK.md",
  boundaryRules: [
    "Reflection compiler layer handles validity paths.",
    "It does not perform scientific-causal judgment.",
  ],
  rejectionCodes: [
    'RJ_GENESIS_UNSAT',
    'RJ_MORPH_ADMISSIBILITY_FAIL',
    'RJ_CONTEXT_INVALID',
    'RJ_PATH_BROKEN',
    'RJ_CONTRADICTION_UNRESOLVED',
    'RJ_GROUND_MISSING',
  ],
} as const;

export type FoundationWorkbookRejectionCode = 'RJ_GENESIS_UNSAT' | 'RJ_MORPH_ADMISSIBILITY_FAIL' | 'RJ_CONTEXT_INVALID' | 'RJ_PATH_BROKEN' | 'RJ_CONTRADICTION_UNRESOLVED' | 'RJ_GROUND_MISSING';

export type FoundationWorkbookCandidate = {
  id: string;
  generated: boolean;
  admissibleMorph: boolean;
  validPath: boolean;
  contradicted: boolean;
  evidence: string[];
};

export type FoundationWorkbookCompilationResult = {
  surviving: FoundationWorkbookCandidate[];
  blessed: FoundationWorkbookCandidate[];
  rejections: Array<{
    candidateId: string;
    code: FoundationWorkbookRejectionCode;
    phase: 'reflection';
    evidence: string[];
    explanation: string;
  }>;
};

export function compileFoundationWorkbookJudgments(
  candidates: FoundationWorkbookCandidate[],
): FoundationWorkbookCompilationResult {
  const surviving = candidates.filter(
    (candidate) =>
      candidate.generated &&
      candidate.admissibleMorph &&
      candidate.validPath &&
      !candidate.contradicted,
  );

  const blessed = [...surviving];

  const rejections = candidates
    .filter((candidate) => !surviving.some((entry) => entry.id === candidate.id))
    .map((candidate) => ({
      candidateId: candidate.id,
      code: 'RJ_PATH_BROKEN' as FoundationWorkbookRejectionCode,
      phase: 'reflection' as const,
      evidence: candidate.evidence,
      explanation: `Candidate ${candidate.id} did not satisfy workbook survivability gates.`,
    }));

  return { surviving, blessed, rejections };
}
