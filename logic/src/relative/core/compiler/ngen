#!/usr/bin/env bash
set -euo pipefail

self_dir="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)"

if [[ $# -eq 0 ]]; then
	echo "Usage: $(basename "$0") <generate-file.ts|all> [tsx args...]"
	exit 1
fi

if [[ "$1" == "all" ]]; then
	shift
	shopt -s nullglob
	files=("$self_dir"/generate-*.ts)
	if (( ${#files[@]} == 0 )); then
		echo "No generate-*.ts files found in $self_dir"
		exit 1
	fi

	for file in "${files[@]}"; do
		echo "==> $(basename "$file")"
		npx tsx "$file" "$@"
	done
	exit 0
fi

target="$1"
shift

if [[ "$target" == /* ]]; then
	script_path="$target"
else
	script_path="$self_dir/$target"
fi

npx tsx "$script_path" "$@"
